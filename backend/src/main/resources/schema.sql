CREATE TABLE tag (
    id INT PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY ,
    tag VARCHAR(255) NOT NULL
);
CREATE TABLE category (
    id INT PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    category VARCHAR(255) NOT NULL
);
CREATE TABLE users (
    id INT PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    username VARCHAR(255) NOT NULL UNIQUE ,
    password VARCHAR(255) NOT NULL,
    email VARCHAR(255) NOT NULL UNIQUE ,
    phone_number VARCHAR(20),
    profile_picture VARCHAR(255),
    role VARCHAR(50),
    status VARCHAR(50),
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    last_login TIMESTAMP
);

CREATE TABLE gallery (
    id INT PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    title VARCHAR(255) NOT NULL,
    description TEXT,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    status VARCHAR(50),
    thumbnail varchar(255) NOT NULL,
    user_id INT NOT NULL REFERENCES users(id) ON DELETE CASCADE,
    category_id INT REFERENCES category(id) ON DELETE SET NULL
);

CREATE TABLE image (
    id INT PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    url VARCHAR(255) NOT NULL,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    gallery_id INT NOT NULL REFERENCES gallery(id) ON DELETE CASCADE
);

CREATE TABLE commentary (
    id INT PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    content TEXT,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    user_id INT NOT NULL REFERENCES users(id) ON DELETE CASCADE,
    gallery_id INT NOT NULL REFERENCES gallery(id) ON DELETE CASCADE,
    image_id INT REFERENCES image(id) ON DELETE CASCADE,
    parent_id INT REFERENCES commentary(id) ON DELETE CASCADE
);


CREATE TABLE subscription (
    id INT PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    subscribed_at TIMESTAMP NOT NULL,
    subscriber_id INT NOT NULL REFERENCES users(id) ON DELETE CASCADE,
    target_user_id INT NOT NULL REFERENCES users(id) ON DELETE CASCADE
);

CREATE TABLE gallery_tag (
    gallery_id INT NOT NULL REFERENCES gallery(id) ON DELETE CASCADE,
    tag_id INT NOT NULL REFERENCES tag(id) ON DELETE CASCADE,
    PRIMARY KEY (gallery_id, tag_id)
);

-- DROP SCHEMA public CASCADE ;
-- CREATE SCHEMA public;